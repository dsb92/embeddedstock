/*
Deployment script for F14I4SemProj4Gr3

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "F14I4SemProj4Gr3"
:setvar DefaultFilePrefix "F14I4SemProj4Gr3"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON,
                CURSOR_DEFAULT LOCAL 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET PAGE_VERIFY NONE,
                DISABLE_BROKER 
            WITH ROLLBACK IMMEDIATE;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Rename refactoring operation with key 99635c61-b05e-41e8-a75c-8c84100802a8 is skipped, element [dbo].[Komponent].[Tags] (SqlSimpleColumn) will not be renamed to g';


GO
PRINT N'Rename refactoring operation with key 529614ae-0fd6-44cd-8819-e461ec00ce08 is skipped, element [dbo].[Komponent].[Kategori] (SqlSimpleColumn) will not be renamed to KomponentNavn';


GO
PRINT N'Rename refactoring operation with key 39dd495c-c152-4bbf-9444-0cfbe5e977c0 is skipped, element [dbo].[Komponent].[Datablad] (SqlSimpleColumn) will not be renamed to Kategori';


GO
PRINT N'Rename refactoring operation with key 0beeca6c-c063-4a98-a6fa-17bbc7cfa5f3, 0663cf83-9494-4b46-990a-23a582ff44c3 is skipped, element [dbo].[Komponent].[EjerID] (SqlSimpleColumn) will not be renamed to Bruger kommetar';


GO
PRINT N'Rename refactoring operation with key 7aec04d7-f833-4398-93b6-ef61a04b8a82, 72a0018a-581d-44f5-a6a3-cc034282f739 is skipped, element [dbo].[Bruger].[Id] (SqlSimpleColumn) will not be renamed to StudentID';


GO
PRINT N'Rename refactoring operation with key 7cf390c8-b11b-4849-8f26-8ab431ad42ff, 45de13f9-e98e-4d35-abd2-e086389def4b is skipped, element [dbo].[Komponent].[Id] (SqlSimpleColumn) will not be renamed to ComponentID';


GO
PRINT N'Rename refactoring operation with key b13adc8b-e614-4316-b6bd-2f1afedb69f0, 28d089fe-16ce-496c-b674-320e523c6137 is skipped, element [dbo].[Komponent].[SerieNr] (SqlSimpleColumn) will not be renamed to Tags';


GO
PRINT N'Rename refactoring operation with key 0ce5d9ef-3f8c-45bd-b026-3a368004303f, f6e7b59a-7aec-4cec-890f-502e8651c5bd is skipped, element [dbo].[Komponent].[g] (SqlSimpleColumn) will not be renamed to Datasheet';


GO
PRINT N'Rename refactoring operation with key 4127de2c-6aa2-421a-9cae-056fae03da02, ad12a297-d31c-4711-9219-32382ed90391 is skipped, element [dbo].[Udlånsinformationer].[Id] (SqlSimpleColumn) will not be renamed to LoanID';


GO
PRINT N'Rename refactoring operation with key 95aa984c-b2b1-4f58-a55f-73f9c2992525, 0e5e8b67-bd3c-4fee-83bb-4c63d14ec14e is skipped, element [dbo].[Udlånsinformationer].[Udlån] (SqlSimpleColumn) will not be renamed to Component';


GO
PRINT N'Rename refactoring operation with key caaeac8b-44aa-4234-a77b-8ba82b2a9b0b is skipped, element [dbo].[Bruger].[Fornavn] (SqlSimpleColumn) will not be renamed to FirstName';


GO
PRINT N'Rename refactoring operation with key c3a3dace-ef2f-430e-86a8-6a16ecda8a89 is skipped, element [dbo].[Bruger].[Efternavn] (SqlSimpleColumn) will not be renamed to LastName';


GO
PRINT N'Rename refactoring operation with key 0167d94c-908f-47b8-9250-71d0669d688e is skipped, element [dbo].[Bruger].[Mobilnr] (SqlSimpleColumn) will not be renamed to MobileNr';


GO
PRINT N'Rename refactoring operation with key ab4e8f0c-58ba-4fcd-93a9-5b0482a723cb is skipped, element [dbo].[Komponent].[KomponentNummer] (SqlSimpleColumn) will not be renamed to ComponentNumber';


GO
PRINT N'Rename refactoring operation with key c23fdfd4-7dd5-4a16-a80b-39f7f882e453 is skipped, element [dbo].[Komponent].[KomponentNavn] (SqlSimpleColumn) will not be renamed to ComponentName';


GO
PRINT N'Rename refactoring operation with key 2f9847bb-af28-4986-b154-cd00c969ea88 is skipped, element [dbo].[Komponent].[Kategori] (SqlSimpleColumn) will not be renamed to Category';


GO
PRINT N'Rename refactoring operation with key bb960dcf-cc13-4552-b728-1360d09723b3 is skipped, element [dbo].[Komponent].[EjerID] (SqlSimpleColumn) will not be renamed to OwnerID';


GO
PRINT N'Rename refactoring operation with key e76cb26d-fc1d-417a-9340-8f41307c04f6 is skipped, element [dbo].[Komponent].[Billede] (SqlSimpleColumn) will not be renamed to Image';


GO
PRINT N'Rename refactoring operation with key 0c970e6d-06e5-401e-8d0d-071e06cb99d0 is skipped, element [dbo].[Komponent].[Udlånsinformation] (SqlSimpleColumn) will not be renamed to Loaninformation';


GO
PRINT N'Rename refactoring operation with key 67752f1c-19f6-4dc7-8e8d-73a7eab83126 is skipped, element [dbo].[Udlånsinformationer].[Adminkommentar] (SqlSimpleColumn) will not be renamed to AdminComment';


GO
PRINT N'Rename refactoring operation with key 0f13e01f-aaaf-4ab1-bca3-d54d3f8843ce is skipped, element [dbo].[Udlånsinformationer].[Brugerkommentar] (SqlSimpleColumn) will not be renamed to UserComment';


GO
PRINT N'Rename refactoring operation with key 4b919081-fd66-4068-86c2-75f4dbce9ef5 is skipped, element [dbo].[Udlånsinformationer].[Udlånsdato] (SqlSimpleColumn) will not be renamed to LoanDate';


GO
PRINT N'Rename refactoring operation with key bf3edcff-00b1-461e-8f19-261db8722beb is skipped, element [dbo].[Udlånsinformationer].[Afleveringsdato] (SqlSimpleColumn) will not be renamed to ReturnDate';


GO
PRINT N'Creating [dbo].[Component]...';


GO
CREATE TABLE [dbo].[Component] (
    [ComponentID]     INT           NOT NULL,
    [ComponentNumber] INT           NOT NULL,
    [Tags]            NVARCHAR (50) NOT NULL,
    [ComponentName]   NVARCHAR (50) NOT NULL,
    [Category]        NVARCHAR (50) NULL,
    [Datasheet]       NVARCHAR (50) NULL,
    [Image]           IMAGE         NULL,
    [OwnerID]         INT           NULL,
    PRIMARY KEY CLUSTERED ([ComponentID] ASC)
);


GO
PRINT N'Creating [dbo].[LoanInformation]...';


GO
CREATE TABLE [dbo].[LoanInformation] (
    [LoanID]       INT           NOT NULL,
    [AdminComment] NVARCHAR (50) NULL,
    [UserComment]  NVARCHAR (50) NULL,
    [LoanDate]     NVARCHAR (50) NULL,
    [ReturnDate]   NVARCHAR (50) NULL,
    [Component]    INT           NOT NULL,
    PRIMARY KEY CLUSTERED ([LoanID] ASC)
);


GO
PRINT N'Creating [dbo].[User]...';


GO
CREATE TABLE [dbo].[User] (
    [StudentID] INT           NOT NULL,
    [FirstName] NVARCHAR (50) NULL,
    [LastName]  NVARCHAR (50) NULL,
    [Email]     NVARCHAR (50) NOT NULL,
    [MobileNr]  INT           NULL,
    PRIMARY KEY CLUSTERED ([StudentID] ASC)
);


GO
PRINT N'Creating FK_Component_ToUser...';


GO
ALTER TABLE [dbo].[Component] WITH NOCHECK
    ADD CONSTRAINT [FK_Component_ToUser] FOREIGN KEY ([OwnerID]) REFERENCES [dbo].[User] ([StudentID]);


GO
PRINT N'Creating FK_LoanInformation_ToComponent...';


GO
ALTER TABLE [dbo].[LoanInformation] WITH NOCHECK
    ADD CONSTRAINT [FK_LoanInformation_ToComponent] FOREIGN KEY ([Component]) REFERENCES [dbo].[Component] ([ComponentID]);


GO
-- Refactoring step to update target server with deployed transaction logs

IF OBJECT_ID(N'dbo.__RefactorLog') IS NULL
BEGIN
    CREATE TABLE [dbo].[__RefactorLog] (OperationKey UNIQUEIDENTIFIER NOT NULL PRIMARY KEY)
    EXEC sp_addextendedproperty N'microsoft_database_tools_support', N'refactoring log', N'schema', N'dbo', N'table', N'__RefactorLog'
END
GO
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '7aec04d7-f833-4398-93b6-ef61a04b8a82')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('7aec04d7-f833-4398-93b6-ef61a04b8a82')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '7cf390c8-b11b-4849-8f26-8ab431ad42ff')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('7cf390c8-b11b-4849-8f26-8ab431ad42ff')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'b13adc8b-e614-4316-b6bd-2f1afedb69f0')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('b13adc8b-e614-4316-b6bd-2f1afedb69f0')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '99635c61-b05e-41e8-a75c-8c84100802a8')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('99635c61-b05e-41e8-a75c-8c84100802a8')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '28d089fe-16ce-496c-b674-320e523c6137')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('28d089fe-16ce-496c-b674-320e523c6137')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '529614ae-0fd6-44cd-8819-e461ec00ce08')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('529614ae-0fd6-44cd-8819-e461ec00ce08')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '39dd495c-c152-4bbf-9444-0cfbe5e977c0')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('39dd495c-c152-4bbf-9444-0cfbe5e977c0')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0ce5d9ef-3f8c-45bd-b026-3a368004303f')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0ce5d9ef-3f8c-45bd-b026-3a368004303f')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0beeca6c-c063-4a98-a6fa-17bbc7cfa5f3')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0beeca6c-c063-4a98-a6fa-17bbc7cfa5f3')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '4127de2c-6aa2-421a-9cae-056fae03da02')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('4127de2c-6aa2-421a-9cae-056fae03da02')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0663cf83-9494-4b46-990a-23a582ff44c3')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0663cf83-9494-4b46-990a-23a582ff44c3')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '95aa984c-b2b1-4f58-a55f-73f9c2992525')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('95aa984c-b2b1-4f58-a55f-73f9c2992525')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '72a0018a-581d-44f5-a6a3-cc034282f739')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('72a0018a-581d-44f5-a6a3-cc034282f739')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'caaeac8b-44aa-4234-a77b-8ba82b2a9b0b')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('caaeac8b-44aa-4234-a77b-8ba82b2a9b0b')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'c3a3dace-ef2f-430e-86a8-6a16ecda8a89')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('c3a3dace-ef2f-430e-86a8-6a16ecda8a89')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0167d94c-908f-47b8-9250-71d0669d688e')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0167d94c-908f-47b8-9250-71d0669d688e')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '45de13f9-e98e-4d35-abd2-e086389def4b')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('45de13f9-e98e-4d35-abd2-e086389def4b')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'ab4e8f0c-58ba-4fcd-93a9-5b0482a723cb')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('ab4e8f0c-58ba-4fcd-93a9-5b0482a723cb')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'c23fdfd4-7dd5-4a16-a80b-39f7f882e453')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('c23fdfd4-7dd5-4a16-a80b-39f7f882e453')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '2f9847bb-af28-4986-b154-cd00c969ea88')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('2f9847bb-af28-4986-b154-cd00c969ea88')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'f6e7b59a-7aec-4cec-890f-502e8651c5bd')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('f6e7b59a-7aec-4cec-890f-502e8651c5bd')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'bb960dcf-cc13-4552-b728-1360d09723b3')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('bb960dcf-cc13-4552-b728-1360d09723b3')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'e76cb26d-fc1d-417a-9340-8f41307c04f6')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('e76cb26d-fc1d-417a-9340-8f41307c04f6')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0c970e6d-06e5-401e-8d0d-071e06cb99d0')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0c970e6d-06e5-401e-8d0d-071e06cb99d0')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'ad12a297-d31c-4711-9219-32382ed90391')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('ad12a297-d31c-4711-9219-32382ed90391')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '67752f1c-19f6-4dc7-8e8d-73a7eab83126')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('67752f1c-19f6-4dc7-8e8d-73a7eab83126')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0f13e01f-aaaf-4ab1-bca3-d54d3f8843ce')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0f13e01f-aaaf-4ab1-bca3-d54d3f8843ce')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '4b919081-fd66-4068-86c2-75f4dbce9ef5')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('4b919081-fd66-4068-86c2-75f4dbce9ef5')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'bf3edcff-00b1-461e-8f19-261db8722beb')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('bf3edcff-00b1-461e-8f19-261db8722beb')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0e5e8b67-bd3c-4fee-83bb-4c63d14ec14e')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0e5e8b67-bd3c-4fee-83bb-4c63d14ec14e')

GO

GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[Component] WITH CHECK CHECK CONSTRAINT [FK_Component_ToUser];

ALTER TABLE [dbo].[LoanInformation] WITH CHECK CHECK CONSTRAINT [FK_LoanInformation_ToComponent];


GO
PRINT N'Update complete.';


GO
